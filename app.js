async function loadIndex(){try{const r=await fetch('data/search_index.json');window.searchIndex=await r.json();if(window.lunr){window.idx=lunr(function(){this.ref('id');this.field('title',{boost:10});this.field('description');this.field('tags');window.searchIndex.forEach(function(d){this.add(d)},this)})}}catch(e){console.error(e)}}function renderResults(items,q){const out=document.getElementById('results');out.innerHTML='';if(!items||items.length===0){out.innerHTML='<p style="opacity:0.95">No results found for <b>'+ (q||'') +'</b>.</p>';return}items.forEach(it=>{const d=document.createElement('div');d.className='result-item';d.innerHTML='<div style="font-weight:700">'+it.title+'</div><div class="meta">'+(it.url?('<a href="'+it.url+'" target="_blank" style="color:inherit;text-decoration:underline">Open resource</a>'):'')+'</div><div style="margin-top:6px;opacity:0.95">'+it.description+'</div>';out.appendChild(d)})}function simpleSearch(q){q=(q||'').toLowerCase().trim();if(!q) return [];return window.searchIndex.filter(i=> (i.title&&i.title.toLowerCase().includes(q))||(i.description&&i.description.toLowerCase().includes(q))||(i.tags&&i.tags.join(' ').toLowerCase().includes(q)))}function doSearch(){const q=document.getElementById('searchBox').value;if(!q||q.trim()===''){renderResults([],q);return}if(window.idx){try{const r=window.idx.search(q+'*');const mapped=r.map(rr=>window.searchIndex.find(d=>d.id===rr.ref)).filter(Boolean);renderResults(mapped,q);return}catch(e){console.warn(e)}}const fb=simpleSearch(q);renderResults(fb,q)}document.addEventListener('DOMContentLoaded',async()=>{await loadIndex();document.getElementById('searchBtn').addEventListener('click',doSearch);document.getElementById('searchBox').addEventListener('keydown',function(e){if(e.key==='Enter')doSearch()})});